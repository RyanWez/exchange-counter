<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Shwe Hundi Manager - á€›á€½á€¾á€±á€Ÿá€½á€”á€ºá€’á€® á€™á€”á€ºá€”á€±á€‚á€»á€¬</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: -apple-system, BlinkMacSystemFont, 'Padauk', 'SF Pro Display', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }

        /* Gold Gradient */
        .gold-gradient {
            background: linear-gradient(135deg, #f7931a 0%, #ffcd00 50%, #f7931a 100%);
        }

        /* Green Gradient */
        .green-gradient {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
        }

        /* Card Styles */
        .card-dark {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-gold {
            background: linear-gradient(135deg, rgba(247, 147, 26, 0.2) 0%, rgba(255, 205, 0, 0.15) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 205, 0, 0.3);
        }

        .card-green {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(0, 206, 201, 0.15) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 206, 201, 0.3);
        }

        /* Segmented Control */
        .segmented-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 4px;
            display: flex;
            position: relative;
            overflow: hidden;
        }

        .segment-btn {
            position: relative;
            z-index: 1;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .segment-btn.active {
            background: linear-gradient(135deg, #f7931a 0%, #ffcd00 100%);
            color: #1a1a2e;
            box-shadow: 0 2px 12px rgba(247, 147, 26, 0.3);
            transform: scale(1.02);
        }

        .segment-btn:active {
            transform: scale(0.98);
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            font-weight: 700;
            border-radius: 14px;
            padding: 16px 24px;
            box-shadow: 0 4px 20px rgba(0, 184, 148, 0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-primary:active {
            transform: scale(0.96);
            box-shadow: 0 2px 10px rgba(0, 184, 148, 0.3);
        }

        .btn-gold {
            background: linear-gradient(135deg, #f7931a 0%, #ffcd00 100%);
            color: #1a1a2e;
            font-weight: 700;
            border-radius: 14px;
            padding: 16px 24px;
            box-shadow: 0 4px 20px rgba(247, 147, 26, 0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-gold:active {
            transform: scale(0.96);
            box-shadow: 0 2px 10px rgba(247, 147, 26, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            border-radius: 14px;
            padding: 14px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }

        .btn-secondary:active {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(0.96);
        }

        /* Input Styles */
        .input-dark {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px 18px;
            font-size: 17px;
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            width: 100%;
        }

        .input-dark:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #00cec9;
            box-shadow: 0 0 0 4px rgba(0, 206, 201, 0.25);
            transform: scale(1.01);
        }

        .input-dark::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Select Styles */
        .select-dark {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 14px 40px 14px 16px;
            font-size: 15px;
            font-weight: 600;
            color: white;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            cursor: pointer;
        }

        .select-dark option {
            background: #1a1a2e;
            color: white;
        }

        /* Tab Bar */
        .tab-bar {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px 4px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-item.active {
            color: #ffcd00;
        }

        .tab-item .tab-icon {
            font-size: 24px;
            line-height: 1;
        }

        /* Payment Pills */
        .payment-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .payment-btn:active {
            transform: scale(0.9);
        }

        .payment-btn.selected {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
            transform: scale(1.05);
        }

        /* Header */
        .app-header {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animations & Transitions */
        :root {
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-ios: cubic-bezier(0.25, 1, 0.5, 1);
        }

        .transition-all-300 {
            transition: all 0.3s var(--ease-ios);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(247, 147, 26, 0.3); }
            50% { box-shadow: 0 0 40px rgba(247, 147, 26, 0.5); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-fadeInUp { animation: fadeInUp 0.5s var(--ease-spring) forwards; }
        .animate-scaleIn { animation: scaleIn 0.4s var(--ease-spring) forwards; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        .animate-slideInRight { animation: slideInRight 0.3s var(--ease-ios) forwards; }

        /* Click Effects */
        .active-scale:active {
            transform: scale(0.95);
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
        }

        /* Smooth Tab Content */
        .tab-content {
            opacity: 0;
            animation: fadeInUp 0.4s var(--ease-ios) forwards;
        }

        /* Modal Overlay */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Voucher Style */
        .voucher-card {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 0; height: 0; }

        /* List item */
        .list-item {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            animation: slideInRight 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0; /* For animation */
        }

        .list-item:nth-child(1) { animation-delay: 0.05s; }
        .list-item:nth-child(2) { animation-delay: 0.1s; }
        .list-item:nth-child(3) { animation-delay: 0.15s; }
        .list-item:nth-child(4) { animation-delay: 0.2s; }
        .list-item:nth-child(5) { animation-delay: 0.25s; }
        /* Add more delays if needed */

        .list-item:active {
            background: rgba(255, 255, 255, 0.12);
            transform: scale(0.96);
        }

        /* Rate Card Colors */
        .rate-card-thb {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.25) 0%, rgba(0, 206, 201, 0.15) 100%);
            border: 1px solid rgba(0, 206, 201, 0.4);
        }

        .rate-card-usd {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
        }

        .rate-card-cny {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.25) 0%, rgba(248, 113, 113, 0.15) 100%);
            border: 1px solid rgba(248, 113, 113, 0.4);
        }

        /* Result Display */
        .result-display {
            background: linear-gradient(135deg, #f7931a 0%, #ffcd00 100%);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(247, 147, 26, 0.3);
        }

        /* Number formatting */
        .number-input::-webkit-inner-spin-button { -webkit-appearance: none; }

        /* Stat Card */
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
        }

        .stat-card-green {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(0, 206, 201, 0.1) 100%);
            border: 1px solid rgba(0, 206, 201, 0.3);
        }

        .stat-card-gold {
            background: linear-gradient(135deg, rgba(247, 147, 26, 0.2) 0%, rgba(255, 205, 0, 0.1) 100%);
            border: 1px solid rgba(255, 205, 0, 0.3);
        }
    </style>
</head>
<body>
    <!-- Lock Screen -->
    <div id="lockScreen" class="fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-gradient-to-br from-purple-900/20 to-blue-900/20"></div>
        <div class="card-dark rounded-3xl p-8 mx-6 w-full max-w-sm animate-scaleIn relative">
            <div class="text-center mb-8">
                <div class="w-24 h-24 gold-gradient rounded-full mx-auto flex items-center justify-center mb-4 shadow-2xl animate-glow">
                    <span class="text-5xl">ğŸ’°</span>
                </div>
                <h1 class="text-3xl font-bold text-white">Shwe Hundi</h1>
                <p class="text-gray-400 text-sm mt-2">á€›á€½á€¾á€±á€Ÿá€½á€”á€ºá€’á€® á€™á€”á€ºá€”á€±á€‚á€»á€¬</p>
            </div>
            <div class="space-y-4">
                <input type="password" id="pinInput" placeholder="PIN á€‘á€Šá€·á€ºá€•á€«" 
                    class="input-dark text-center text-2xl tracking-[0.5em]"
                    maxlength="4">
                <button onclick="unlockApp()" class="w-full btn-gold text-lg">
                    ğŸ”“ á€á€„á€ºá€›á€±á€¬á€€á€ºá€™á€Šá€º
                </button>
                <p class="text-center text-gray-500 text-xs">Default PIN: 1234</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden pb-24">
        <!-- Header -->
        <header class="app-header sticky top-0 z-40 px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 gold-gradient rounded-2xl flex items-center justify-center shadow-lg">
                        <span class="text-2xl">ğŸ’°</span>
                    </div>
                    <div>
                        <h1 class="font-bold text-white text-xl">Shwe Hundi</h1>
                        <p class="text-gray-400 text-xs" id="currentDate"></p>
                    </div>
                </div>
                <button onclick="showSettings()" class="w-10 h-10 rounded-full flex items-center justify-center bg-white/10 hover:bg-white/20 transition active:scale-90 active:rotate-90 duration-300">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Quick Rate Display -->
        <div class="mx-4 mt-3 card-gold rounded-2xl p-4">
            <div class="flex justify-around text-center">
                <div>
                    <p class="text-xs text-amber-200 mb-1">ğŸ‡¹ğŸ‡­ THB</p>
                    <p class="font-bold text-white text-sm" id="quickThb">-</p>
                </div>
                <div class="w-px bg-amber-400/30"></div>
                <div>
                    <p class="text-xs text-amber-200 mb-1">ğŸ‡ºğŸ‡¸ USD</p>
                    <p class="font-bold text-white text-sm" id="quickUsd">-</p>
                </div>
                <div class="w-px bg-amber-400/30"></div>
                <div>
                    <p class="text-xs text-amber-200 mb-1">ğŸ‡¨ğŸ‡³ CNY</p>
                    <p class="font-bold text-white text-sm" id="quickCny">-</p>
                </div>
            </div>
        </div>

        <!-- Tab Contents -->
        <main class="px-4 pt-4">
            <!-- Rate Board Tab -->
            <div id="content-rate" class="tab-content hidden">
                <div class="card-dark rounded-3xl p-5">
                    <h2 class="text-xl font-bold text-white mb-5 flex items-center gap-2">
                        ğŸ“Š á€šá€”á€±á€· á€•á€±á€«á€€á€ºá€ˆá€±á€¸
                    </h2>
                    
                    <!-- THB Rate -->
                    <div class="mb-4 p-4 rate-card-thb rounded-2xl">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-2xl">ğŸ‡¹ğŸ‡­</span>
                            <span class="font-bold text-white">á€‘á€­á€¯á€„á€ºá€¸á€˜á€á€º (THB)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-teal-200 mb-1 block">á€á€šá€º (1 á€˜á€á€º = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="0.01" id="thbBuy" class="input-dark text-center font-bold" placeholder="122.7">
                            </div>
                            <div>
                                <label class="text-xs text-teal-200 mb-1 block">á€›á€±á€¬á€„á€ºá€¸ (1 á€˜á€á€º = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="0.01" id="thbSell" class="input-dark text-center font-bold" placeholder="125.79">
                            </div>
                        </div>
                        <p class="mt-3 text-sm text-teal-300">ğŸ’° á€¡á€™á€¼á€á€º: <span id="thbProfit" class="font-bold text-white">0</span> á€€á€»á€•á€º/á€˜á€á€º</p>
                    </div>

                    <!-- USD Rate -->
                    <div class="mb-4 p-4 rate-card-usd rounded-2xl">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-2xl">ğŸ‡ºğŸ‡¸</span>
                            <span class="font-bold text-white">á€’á€±á€«á€ºá€œá€¬ (USD)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-purple-200 mb-1 block">á€á€šá€º (1$ = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="1" id="usdBuy" class="input-dark text-center font-bold" placeholder="3945">
                            </div>
                            <div>
                                <label class="text-xs text-purple-200 mb-1 block">á€›á€±á€¬á€„á€ºá€¸ (1$ = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="1" id="usdSell" class="input-dark text-center font-bold" placeholder="4045">
                            </div>
                        </div>
                        <p class="mt-3 text-sm text-purple-300">ğŸ’° á€¡á€™á€¼á€á€º: <span id="usdProfit" class="font-bold text-white">0</span> á€€á€»á€•á€º/$</p>
                    </div>

                    <!-- CNY Rate -->
                    <div class="mb-6 p-4 rate-card-cny rounded-2xl">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-2xl">ğŸ‡¨ğŸ‡³</span>
                            <span class="font-bold text-white">á€šá€½á€™á€º (CNY)</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-red-200 mb-1 block">á€á€šá€º (1Â¥ = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="1" id="cnyBuy" class="input-dark text-center font-bold" placeholder="558">
                            </div>
                            <div>
                                <label class="text-xs text-red-200 mb-1 block">á€›á€±á€¬á€„á€ºá€¸ (1Â¥ = ? á€€á€»á€•á€º)</label>
                                <input type="number" step="1" id="cnySell" class="input-dark text-center font-bold" placeholder="572">
                            </div>
                        </div>
                        <p class="mt-3 text-sm text-red-300">ğŸ’° á€¡á€™á€¼á€á€º: <span id="cnyProfit" class="font-bold text-white">0</span> á€€á€»á€•á€º/Â¥</p>
                    </div>

                    <button onclick="saveRates()" class="w-full btn-gold text-lg">
                        âœ“ á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ á€á€­á€™á€ºá€¸á€™á€Šá€º
                    </button>
                </div>
            </div>

            <!-- Calculator & Transaction Tab -->
            <div id="content-calc" class="tab-content">
                <!-- Mode Selection -->
                <div class="segmented-control flex mb-4">
                    <button onclick="setMode('exchange')" id="mode-exchange" class="segment-btn flex-1 active">
                        ğŸ’± á€„á€½á€±á€œá€²á€™á€Šá€º
                    </button>
                    <button onclick="setMode('transfer')" id="mode-transfer" class="segment-btn flex-1">
                        ğŸ“¤ á€„á€½á€±á€œá€½á€¾á€²á€™á€Šá€º
                    </button>
                </div>

                <div class="card-dark rounded-3xl p-5">
                    <!-- Currency Pair Selection -->
                    <div class="flex items-center justify-center gap-3 mb-5">
                        <select id="fromCurrency" onchange="updateCalculation()" class="select-dark flex-1 text-center">
                            <option value="MMK">ğŸ‡²ğŸ‡² MMK á€€á€»á€•á€º</option>
                            <option value="THB">ğŸ‡¹ğŸ‡­ THB á€˜á€á€º</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ USD á€’á€±á€«á€ºá€œá€¬</option>
                            <option value="CNY">ğŸ‡¨ğŸ‡³ CNY á€šá€½á€™á€º</option>
                        </select>
                        <button onclick="swapCurrency()" class="w-14 h-14 gold-gradient rounded-full flex items-center justify-center shadow-lg transition-all duration-300 active:scale-90 hover:rotate-180">
                            <span class="text-2xl">â‡„</span>
                        </button>
                        <select id="toCurrency" onchange="updateCalculation()" class="select-dark flex-1 text-center">
                            <option value="THB">ğŸ‡¹ğŸ‡­ THB á€˜á€á€º</option>
                            <option value="MMK">ğŸ‡²ğŸ‡² MMK á€€á€»á€•á€º</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ USD á€’á€±á€«á€ºá€œá€¬</option>
                            <option value="CNY">ğŸ‡¨ğŸ‡³ CNY á€šá€½á€™á€º</option>
                        </select>
                    </div>

                    <!-- Amount Input -->
                    <div class="mb-4">
                        <label class="text-xs text-gray-400 mb-2 block">á€•á€™á€¬á€</label>
                        <input type="text" id="inputAmount" oninput="formatAndCalculate(this)" 
                            class="input-dark text-center text-3xl font-bold"
                            placeholder="0">
                    </div>

                    <!-- Exchange Rate Display -->
                    <div class="text-center py-3 bg-white/5 rounded-xl mb-4">
                        <p class="text-xs text-gray-500">á€œá€€á€ºá€›á€¾á€­ á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</p>
                        <p class="text-base font-bold text-teal-400" id="currentRateDisplay">1 THB = 100 MMK</p>
                    </div>

                    <!-- Result Display -->
                    <div class="result-display mb-5 text-center">
                        <p class="text-sm text-amber-900/70 mb-1">á€›á€›á€¾á€­á€™á€Šá€·á€º á€•á€™á€¬á€</p>
                        <p class="text-4xl font-bold text-gray-900" id="resultAmount">0</p>
                    </div>

                    <!-- Service Fee -->
                    <div class="mb-4">
                        <label class="text-xs text-gray-400 mb-2 block">á€á€”á€ºá€†á€±á€¬á€„á€ºá€ (á€€á€»á€•á€º)</label>
                        <input type="text" id="serviceFee" oninput="formatNumber(this)" 
                            class="input-dark text-center font-bold"
                            placeholder="0">
                    </div>

                    <!-- Payment Method -->
                    <div class="mb-4">
                        <label class="text-xs text-gray-400 mb-2 block">á€„á€½á€±á€•á€±á€¸á€á€»á€±á€•á€¯á€¶</label>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="selectPayment('cash')" data-payment="cash" class="payment-btn selected">
                                ğŸ’µ Cash
                            </button>
                            <button onclick="selectPayment('kpay')" data-payment="kpay" class="payment-btn">
                                ğŸ“± KPay
                            </button>
                            <button onclick="selectPayment('wave')" data-payment="wave" class="payment-btn">
                                ğŸŒŠ Wave
                            </button>
                            <button onclick="selectPayment('bank')" data-payment="bank" class="payment-btn">
                                ğŸ¦ Bank
                            </button>
                        </div>
                    </div>

                    <!-- Customer Selection -->
                    <div class="mb-5">
                        <label class="text-xs text-gray-400 mb-2 block">á€–á€±á€¬á€€á€ºá€á€Šá€º</label>
                        <select id="customerSelect" class="select-dark w-full">
                            <option value="">-- á€–á€±á€¬á€€á€ºá€á€Šá€º á€›á€½á€±á€¸á€•á€« --</option>
                        </select>
                    </div>

                    <!-- Transfer Mode - Recipient Info -->
                    <div id="transferInfo" class="hidden mb-5 p-4 card-green rounded-2xl">
                        <h4 class="font-bold text-teal-300 mb-3 flex items-center gap-2">
                            <span>ğŸ“</span> á€œá€€á€ºá€á€¶á€™á€Šá€·á€ºá€á€°
                        </h4>
                        <input type="text" id="recipientName" class="input-dark mb-2" placeholder="á€¡á€™á€Šá€º">
                        <input type="text" id="recipientPhone" class="input-dark mb-2" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
                        <input type="text" id="recipientLocation" class="input-dark" placeholder="á€”á€±á€›á€•á€ºá€œá€­á€•á€ºá€…á€¬">
                    </div>

                    <!-- Confirm Button -->
                    <button onclick="saveTransaction()" class="w-full btn-primary text-lg">
                        âœ“ á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º
                    </button>
                </div>
            </div>

            <!-- Customer Tab -->
            <div id="content-customer" class="tab-content hidden animate-fadeInUp">
                <div class="card-dark rounded-3xl p-5 mb-4">
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        ğŸ‘¥ á€–á€±á€¬á€€á€ºá€á€Šá€º á€¡á€á€…á€º
                    </h2>
                    <input type="text" id="newCustomerName" class="input-dark mb-3" placeholder="á€¡á€™á€Šá€º">
                    <input type="text" id="newCustomerPhone" class="input-dark mb-3" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
                    <input type="text" id="newCustomerNote" class="input-dark mb-4" placeholder="á€™á€¾á€á€ºá€á€»á€€á€º">
                    <button onclick="addCustomer()" class="w-full btn-primary">
                        + á€–á€±á€¬á€€á€ºá€á€Šá€º á€‘á€Šá€·á€ºá€™á€Šá€º
                    </button>
                </div>

                <div class="card-dark rounded-3xl p-5">
                    <h2 class="text-lg font-bold text-white mb-4">ğŸ“‹ á€–á€±á€¬á€€á€ºá€á€Šá€º á€…á€¬á€›á€„á€ºá€¸</h2>
                    <div id="customerList" class="space-y-3">
                        <!-- Customer items -->
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="content-history" class="tab-content hidden animate-fadeInUp">
                <div class="card-dark rounded-3xl p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-white">ğŸ“‹ á€™á€¾á€á€ºá€á€™á€ºá€¸</h2>
                        <input type="date" id="filterDate" onchange="filterHistory()" class="input-dark w-auto text-sm px-3 py-2">
                    </div>
                    <div id="historyList" class="space-y-3">
                        <!-- History items -->
                    </div>
                </div>
            </div>

            <!-- Daily Closing Tab -->
            <div id="content-closing" class="tab-content hidden animate-fadeInUp">
                <div class="card-dark rounded-3xl p-5 mb-4">
                    <h2 class="text-xl font-bold text-white mb-5">ğŸ“ˆ á€šá€”á€±á€· á€…á€¬á€›á€„á€ºá€¸á€á€»á€¯á€•á€º</h2>
                    
                    <!-- Transaction Summary -->
                    <div class="grid grid-cols-2 gap-3 mb-5">
                        <div class="stat-card-green rounded-2xl text-center p-4">
                            <p class="text-xs text-teal-200 mb-1">á€¡á€€á€¼á€­á€™á€ºá€›á€±</p>
                            <p class="text-3xl font-bold text-white" id="totalTransactions">0</p>
                        </div>
                        <div class="stat-card-gold rounded-2xl text-center p-4">
                            <p class="text-xs text-amber-200 mb-1">á€á€”á€ºá€†á€±á€¬á€„á€ºá€</p>
                            <p class="text-xl font-bold text-white" id="totalServiceFee">0</p>
                        </div>
                    </div>

                    <!-- Money Flow -->
                    <h3 class="font-bold text-gray-300 mb-3">ğŸ’° á€„á€½á€±á€…á€®á€¸á€†á€„á€ºá€¸á€™á€¾á€¯</h3>
                    
                    <div class="space-y-3 mb-5">
                        <div class="p-4 stat-card rounded-2xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-white">ğŸ‡²ğŸ‡² MMK</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between"><span class="text-gray-400">á€á€„á€º:</span><span class="font-bold text-green-400" id="mmkIn">0</span></div>
                                <div class="flex justify-between"><span class="text-gray-400">á€‘á€½á€€á€º:</span><span class="font-bold text-red-400" id="mmkOut">0</span></div>
                            </div>
                        </div>

                        <div class="p-4 stat-card rounded-2xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-white">ğŸ‡¹ğŸ‡­ THB</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between"><span class="text-gray-400">á€á€„á€º:</span><span class="font-bold text-green-400" id="thbIn">0</span></div>
                                <div class="flex justify-between"><span class="text-gray-400">á€‘á€½á€€á€º:</span><span class="font-bold text-red-400" id="thbOut">0</span></div>
                            </div>
                        </div>

                        <div class="p-4 stat-card rounded-2xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-white">ğŸ‡ºğŸ‡¸ USD</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between"><span class="text-gray-400">á€á€„á€º:</span><span class="font-bold text-green-400" id="usdIn">0</span></div>
                                <div class="flex justify-between"><span class="text-gray-400">á€‘á€½á€€á€º:</span><span class="font-bold text-red-400" id="usdOut">0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Stock -->
                    <h3 class="font-bold text-gray-300 mb-3">ğŸ¦ á€œá€€á€ºá€€á€»á€”á€º</h3>
                    <div class="grid grid-cols-2 gap-3 mb-5">
                        <div>
                            <label class="text-xs text-gray-400 mb-1 block">MMK</label>
                            <input type="text" id="stockMmk" oninput="formatNumber(this)" class="input-dark text-right font-bold" placeholder="0">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 mb-1 block">THB</label>
                            <input type="text" id="stockThb" oninput="formatNumber(this)" class="input-dark text-right font-bold" placeholder="0">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 mb-1 block">USD</label>
                            <input type="text" id="stockUsd" oninput="formatNumber(this)" class="input-dark text-right font-bold" placeholder="0">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 mb-1 block">CNY</label>
                            <input type="text" id="stockCny" oninput="formatNumber(this)" class="input-dark text-right font-bold" placeholder="0">
                        </div>
                    </div>

                    <!-- Profit Summary -->
                    <div class="result-display text-center mb-5">
                        <p class="text-sm text-amber-900/70 mb-1">á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸ á€¡á€™á€¼á€á€º</p>
                        <p class="text-3xl font-bold text-gray-900" id="estimatedProfit">0 Ks</p>
                    </div>

                    <button onclick="saveDailyClosing()" class="w-full btn-gold">
                        ğŸ’¾ á€á€­á€™á€ºá€¸á€™á€Šá€º
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Tab Bar -->
        <nav class="tab-bar fixed bottom-0 left-0 right-0 z-40 px-2 pb-6 pt-2">
            <div class="flex justify-around">
                <button onclick="showTab('rate')" id="tab-rate" class="tab-item">
                    <span class="tab-icon">ğŸ“Š</span>
                    <span>á€•á€±á€«á€€á€ºá€ˆá€±á€¸</span>
                </button>
                <button onclick="showTab('calc')" id="tab-calc" class="tab-item active">
                    <span class="tab-icon">ğŸ§®</span>
                    <span>á€á€½á€€á€ºá€á€»á€€á€º</span>
                </button>
                <button onclick="showTab('customer')" id="tab-customer" class="tab-item">
                    <span class="tab-icon">ğŸ‘¥</span>
                    <span>á€–á€±á€¬á€€á€ºá€á€Šá€º</span>
                </button>
                <button onclick="showTab('history')" id="tab-history" class="tab-item">
                    <span class="tab-icon">ğŸ“‹</span>
                    <span>á€™á€¾á€á€ºá€á€™á€ºá€¸</span>
                </button>
                <button onclick="showTab('closing')" id="tab-closing" class="tab-item">
                    <span class="tab-icon">ğŸ“ˆ</span>
                    <span>á€…á€¬á€›á€„á€ºá€¸á€á€»á€¯á€•á€º</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Voucher Modal -->
    <div id="voucherModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 modal-overlay" onclick="closeVoucherModal()"></div>
        <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto animate-scaleIn">
            <div id="voucherContent" class="voucher-card p-6">
                <!-- Voucher content -->
            </div>
            <div class="flex gap-2 mt-4">
                <button onclick="copyVoucherText()" class="flex-1 btn-secondary">
                    ğŸ“‹ Copy
                </button>
                <button onclick="shareVoucher()" class="flex-1 btn-gold">
                    ğŸ“¤ Share
                </button>
                <button onclick="closeVoucherModal()" class="flex-1 btn-secondary">
                    âœ• á€•á€­á€á€ºá€™á€Šá€º
                </button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 modal-overlay"></div>
        <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-sm mx-auto animate-scaleIn">
            <div class="card-dark rounded-3xl p-6">
                <div class="text-center mb-5">
                    <div class="w-16 h-16 bg-amber-500/20 rounded-full mx-auto flex items-center justify-center mb-3">
                        <span class="text-3xl">âš ï¸</span>
                    </div>
                    <h3 class="text-lg font-bold text-white" id="confirmTitle">á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€«</h3>
                    <p class="text-gray-400 mt-2 text-sm" id="confirmMessage"></p>
                </div>
                <div class="flex gap-3">
                    <button onclick="handleConfirm(false)" class="flex-1 btn-secondary">
                        á€™á€œá€¯á€•á€ºá€•á€«
                    </button>
                    <button onclick="handleConfirm(true)" class="flex-1 bg-red-500 text-white font-bold rounded-xl py-3 hover:bg-red-600 transition">
                        á€œá€¯á€•á€ºá€™á€Šá€º
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Modal -->
    <div id="promptModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 modal-overlay"></div>
        <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-sm mx-auto animate-scaleIn">
            <div class="card-dark rounded-3xl p-6">
                <div class="text-center mb-4">
                    <div class="w-16 h-16 gold-gradient rounded-full mx-auto flex items-center justify-center mb-3">
                        <span class="text-3xl">âœï¸</span>
                    </div>
                    <h3 class="text-lg font-bold text-white" id="promptTitle">á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«</h3>
                </div>
                <input type="text" id="promptInput" class="input-dark text-center mb-4">
                <div class="flex gap-3">
                    <button onclick="handlePrompt(false)" class="flex-1 btn-secondary">
                        á€™á€œá€¯á€•á€ºá€•á€«
                    </button>
                    <button onclick="handlePrompt(true)" class="flex-1 btn-gold">
                        á€¡á€­á€¯á€€á€±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-28 left-1/2 -translate-x-1/2 bg-gray-900/95 text-white px-6 py-3 rounded-full shadow-2xl hidden transition-all text-sm font-medium border border-white/10">
        <span id="toastMessage"></span>
    </div>

    <script>
        // ========== DATA STORAGE ==========
        let appData = {
            rates: { 
                thb: { buy: 122.7, sell: 125.79 }, 
                usd: { buy: 3945, sell: 4045 }, 
                cny: { buy: 558, sell: 572 } 
            },
            transactions: [],
            customers: [],
            dailyClosing: [],
            settings: { shopName: 'Shwe Hundi', pin: '1234' }
        };

        let currentPayment = 'cash';
        let currentMode = 'exchange';
        let currentVoucherText = '';
        let confirmCallback = null;
        let promptCallback = null;

        // ========== NUMBER FORMATTING ==========
        function formatNum(num, decimals = 0) {
            if (num === null || num === undefined || isNaN(num)) return '0';
            return Number(num).toLocaleString('en-US', { 
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals 
            });
        }

        function formatNumAuto(num) {
            if (num === null || num === undefined || isNaN(num)) return '0';
            return Number(num).toLocaleString('en-US', { maximumFractionDigits: 2 });
        }

        // ========== CUSTOM MODALS ==========
        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            confirmCallback = callback;
        }

        function handleConfirm(result) {
            document.getElementById('confirmModal').classList.add('hidden');
            if (confirmCallback) {
                confirmCallback(result);
                confirmCallback = null;
            }
        }

        function showPrompt(title, defaultValue, callback) {
            document.getElementById('promptTitle').textContent = title;
            document.getElementById('promptInput').value = defaultValue || '';
            document.getElementById('promptModal').classList.remove('hidden');
            document.getElementById('promptInput').focus();
            promptCallback = callback;
        }

        function handlePrompt(confirmed) {
            document.getElementById('promptModal').classList.add('hidden');
            if (promptCallback) {
                if (confirmed) {
                    promptCallback(document.getElementById('promptInput').value);
                } else {
                    promptCallback(null);
                }
                promptCallback = null;
            }
        }

        document.getElementById('promptInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handlePrompt(true);
        });

        // ========== INITIALIZATION ==========
        function init() {
            loadData();
            updateCurrentDate();
            updateQuickRates();
            loadRateInputs();
            loadCustomerList();
            loadHistory();
            updateClosingSummary();
            updateCustomerSelect();
            showTab('calc');
        }

        function loadData() {
            const saved = localStorage.getItem('shweHundiData');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('shweHundiData', JSON.stringify(appData));
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
            const dateStr = now.toLocaleDateString('en-US', options);
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('filterDate').value = now.toISOString().split('T')[0];
        }

        // ========== LOCK SCREEN ==========
        function unlockApp() {
            const pin = document.getElementById('pinInput').value;
            if (pin === appData.settings.pin) {
                // Prepare Main App
                document.getElementById('mainApp').classList.remove('hidden');
                init();
                
                // Animate Lock Screen Away
                const lockScreen = document.getElementById('lockScreen');
                lockScreen.style.transition = 'opacity 0.6s cubic-bezier(0.25, 1, 0.5, 1), transform 0.6s cubic-bezier(0.25, 1, 0.5, 1)';
                lockScreen.style.opacity = '0';
                lockScreen.style.transform = 'scale(1.1) translateY(-20px)';
                lockScreen.style.pointerEvents = 'none';
                
                setTimeout(() => {
                    lockScreen.classList.add('hidden');
                }, 600);
            } else {
                showToast('PIN á€™á€¾á€¬á€¸á€”á€±á€•á€«á€á€Šá€º! âŒ');
                document.getElementById('pinInput').value = '';
                // Shake animation for error
                const input = document.getElementById('pinInput');
                input.style.transform = 'translateX(10px)';
                setTimeout(() => input.style.transform = 'translateX(-10px)', 100);
                setTimeout(() => input.style.transform = 'translateX(0)', 200);
            }
        }

        document.getElementById('pinInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') unlockApp();
        });

        // ========== TAB NAVIGATION ==========
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('animate-fadeInUp'); // Reset animation class
            });
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            
            const content = document.getElementById('content-' + tabName);
            content.classList.remove('hidden');
            // Force reflow to restart animation
            void content.offsetWidth; 
            content.classList.add('animate-fadeInUp');
            
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // ========== RATE BOARD ==========
        function loadRateInputs() {
            document.getElementById('thbBuy').value = appData.rates.thb.buy;
            document.getElementById('thbSell').value = appData.rates.thb.sell;
            document.getElementById('usdBuy').value = appData.rates.usd.buy;
            document.getElementById('usdSell').value = appData.rates.usd.sell;
            document.getElementById('cnyBuy').value = appData.rates.cny.buy;
            document.getElementById('cnySell').value = appData.rates.cny.sell;
            updateProfitMargins();
        }

        function updateProfitMargins() {
            const thbProfit = (parseFloat(document.getElementById('thbSell').value) || 0) - (parseFloat(document.getElementById('thbBuy').value) || 0);
            const usdProfit = (parseFloat(document.getElementById('usdSell').value) || 0) - (parseFloat(document.getElementById('usdBuy').value) || 0);
            const cnyProfit = (parseFloat(document.getElementById('cnySell').value) || 0) - (parseFloat(document.getElementById('cnyBuy').value) || 0);
            
            document.getElementById('thbProfit').textContent = formatNumAuto(thbProfit);
            document.getElementById('usdProfit').textContent = formatNum(usdProfit);
            document.getElementById('cnyProfit').textContent = formatNum(cnyProfit);
        }

        ['thbBuy', 'thbSell', 'usdBuy', 'usdSell', 'cnyBuy', 'cnySell'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateProfitMargins);
        });

        function saveRates() {
            appData.rates = {
                thb: { buy: parseFloat(document.getElementById('thbBuy').value) || 0, sell: parseFloat(document.getElementById('thbSell').value) || 0 },
                usd: { buy: parseFloat(document.getElementById('usdBuy').value) || 0, sell: parseFloat(document.getElementById('usdSell').value) || 0 },
                cny: { buy: parseFloat(document.getElementById('cnyBuy').value) || 0, sell: parseFloat(document.getElementById('cnySell').value) || 0 }
            };
            saveData();
            updateQuickRates();
            updateCalculation();
            showToast('á€á€­á€™á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® âœ“');
        }

        function updateQuickRates() {
            document.getElementById('quickThb').textContent = `${formatNumAuto(appData.rates.thb.buy)} / ${formatNumAuto(appData.rates.thb.sell)}`;
            document.getElementById('quickUsd').textContent = `${formatNum(appData.rates.usd.buy)} / ${formatNum(appData.rates.usd.sell)}`;
            document.getElementById('quickCny').textContent = `${formatNum(appData.rates.cny.buy)} / ${formatNum(appData.rates.cny.sell)}`;
        }

        // ========== CALCULATOR ==========
        function setMode(mode) {
            currentMode = mode;
            document.getElementById('mode-exchange').classList.toggle('active', mode === 'exchange');
            document.getElementById('mode-transfer').classList.toggle('active', mode === 'transfer');
            document.getElementById('transferInfo').classList.toggle('hidden', mode !== 'transfer');
        }

        function swapCurrency() {
            const from = document.getElementById('fromCurrency');
            const to = document.getElementById('toCurrency');
            const temp = from.value;
            from.value = to.value;
            to.value = temp;
            updateCalculation();
        }

        function formatNumber(input) {
            let value = input.value.replace(/[^0-9]/g, '');
            input.value = value ? parseInt(value).toLocaleString('en-US') : '';
        }

        function formatAndCalculate(input) {
            formatNumber(input);
            updateCalculation();
        }

        function getRate(from, to) {
            if (from === to) return 1;
            
            if (from === 'MMK') {
                if (to === 'THB') return 1 / appData.rates.thb.sell;
                if (to === 'USD') return 1 / appData.rates.usd.sell;
                if (to === 'CNY') return 1 / appData.rates.cny.sell;
            }
            if (to === 'MMK') {
                if (from === 'THB') return appData.rates.thb.buy;
                if (from === 'USD') return appData.rates.usd.buy;
                if (from === 'CNY') return appData.rates.cny.buy;
            }
            const fromToMmk = getRate(from, 'MMK');
            const mmkToTo = getRate('MMK', to);
            return fromToMmk * mmkToTo;
        }

        function updateCalculation() {
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            const amountStr = document.getElementById('inputAmount').value.replace(/,/g, '');
            const amount = parseFloat(amountStr) || 0;
            
            const rate = getRate(from, to);
            const result = amount * rate;
            
            document.getElementById('resultAmount').textContent = formatNumAuto(result) + ' ' + to;
            
            if (from === 'MMK' && to !== 'MMK') {
                const sellRate = appData.rates[to.toLowerCase()]?.sell || 1;
                document.getElementById('currentRateDisplay').textContent = `1 ${to} = ${formatNumAuto(sellRate)} MMK`;
            } else if (from !== 'MMK' && to === 'MMK') {
                const buyRate = appData.rates[from.toLowerCase()]?.buy || 1;
                document.getElementById('currentRateDisplay').textContent = `1 ${from} = ${formatNumAuto(buyRate)} MMK`;
            } else {
                document.getElementById('currentRateDisplay').textContent = `1 ${from} = ${formatNumAuto(rate)} ${to}`;
            }
        }

        function selectPayment(method) {
            currentPayment = method;
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-payment="${method}"]`).classList.add('selected');
        }

        // ========== TRANSACTION ==========
        function saveTransaction() {
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            const amountStr = document.getElementById('inputAmount').value.replace(/,/g, '');
            const amount = parseFloat(amountStr) || 0;
            const feeStr = document.getElementById('serviceFee').value.replace(/,/g, '');
            const fee = parseFloat(feeStr) || 0;
            const customerId = document.getElementById('customerSelect').value;
            
            if (amount <= 0) {
                showToast('á€•á€™á€¬á€ á€‘á€Šá€·á€ºá€•á€«!');
                return;
            }

            const rate = getRate(from, to);
            const result = amount * rate;
            
            const transaction = {
                id: 'TXN' + Date.now(),
                type: currentMode,
                fromCurrency: from,
                toCurrency: to,
                fromAmount: amount,
                toAmount: result,
                rate: rate,
                serviceFee: fee,
                payment: currentPayment,
                customerId: customerId,
                customerName: customerId ? appData.customers.find(c => c.id === customerId)?.name : 'Walk-in',
                recipient: currentMode === 'transfer' ? {
                    name: document.getElementById('recipientName').value,
                    phone: document.getElementById('recipientPhone').value,
                    location: document.getElementById('recipientLocation').value
                } : null,
                rateSnapshot: { ...appData.rates },
                timestamp: new Date().toISOString()
            };

            appData.transactions.push(transaction);
            saveData();
            
            showVoucher(transaction);
            loadHistory();
            updateClosingSummary();
            clearCalculator();
            
            showToast('á€á€­á€™á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® âœ“');
        }

        function clearCalculator() {
            document.getElementById('inputAmount').value = '';
            document.getElementById('serviceFee').value = '';
            document.getElementById('resultAmount').textContent = '0';
            document.getElementById('recipientName').value = '';
            document.getElementById('recipientPhone').value = '';
            document.getElementById('recipientLocation').value = '';
        }

        // ========== VOUCHER ==========
        function showVoucher(tx) {
            const date = new Date(tx.timestamp);
            const formattedDate = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
            
            let voucherHTML = `
                <div class="text-center border-b border-white/20 pb-4 mb-4">
                    <div class="w-16 h-16 gold-gradient rounded-full mx-auto flex items-center justify-center mb-2 shadow-lg">
                        <span class="text-2xl">ğŸ’°</span>
                    </div>
                    <h2 class="text-xl font-bold text-white">${appData.settings.shopName}</h2>
                    <p class="text-sm text-gray-400">${tx.type === 'exchange' ? 'á€„á€½á€±á€œá€²á€•á€¼á€±á€…á€¬' : 'á€„á€½á€±á€œá€½á€¾á€²á€•á€¼á€±á€…á€¬'}</p>
                </div>
                
                <div class="space-y-2 text-sm mb-4">
                    <div class="flex justify-between">
                        <span class="text-gray-400">ID:</span>
                        <span class="font-medium text-teal-400">${tx.id}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">á€”á€±á€·á€…á€½á€²:</span>
                        <span class="font-medium text-white">${formattedDate}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">á€–á€±á€¬á€€á€ºá€á€Šá€º:</span>
                        <span class="font-medium text-white">${tx.customerName}</span>
                    </div>
                </div>
                
                <div class="bg-white/10 rounded-2xl p-4 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-400">á€•á€±á€¸á€„á€½á€±:</span>
                        <span class="text-xl font-bold text-white">${formatNum(tx.fromAmount)} ${tx.fromCurrency}</span>
                    </div>
                    <div class="text-center text-gray-500 text-xs my-2">Rate: 1 ${tx.fromCurrency} = ${tx.rate.toFixed(4)} ${tx.toCurrency}</div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">á€›á€„á€½á€±:</span>
                        <span class="text-xl font-bold text-amber-400">${formatNumAuto(tx.toAmount)} ${tx.toCurrency}</span>
                    </div>
                </div>
                
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-400">á€á€”á€ºá€†á€±á€¬á€„á€ºá€:</span>
                    <span class="font-medium text-white">${formatNum(tx.serviceFee)} Ks</span>
                </div>
                <div class="flex justify-between text-sm mb-4">
                    <span class="text-gray-400">á€„á€½á€±á€•á€±á€¸á€á€»á€±á€•á€¯á€¶:</span>
                    <span class="font-medium text-white">${tx.payment.toUpperCase()}</span>
                </div>
            `;

            if (tx.recipient && tx.recipient.name) {
                voucherHTML += `
                    <div class="bg-teal-500/20 rounded-2xl p-4 mb-4 border border-teal-500/30">
                        <p class="font-bold text-teal-300 mb-2">ğŸ“ á€œá€€á€ºá€á€¶á€™á€Šá€·á€ºá€á€°</p>
                        <p class="text-sm text-white">${tx.recipient.name}</p>
                        <p class="text-sm text-gray-400">${tx.recipient.phone}</p>
                        <p class="text-sm text-gray-400">${tx.recipient.location}</p>
                    </div>
                `;
            }

            voucherHTML += `
                <div class="text-center text-xs text-gray-500 border-t border-white/10 pt-4">
                    <p>á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€Šá€º ğŸ™</p>
                </div>
            `;

            document.getElementById('voucherContent').innerHTML = voucherHTML;
            document.getElementById('voucherModal').classList.remove('hidden');

            currentVoucherText = `
ğŸ“‹ ${appData.settings.shopName} - ${tx.type === 'exchange' ? 'á€„á€½á€±á€œá€²' : 'á€„á€½á€±á€œá€½á€¾á€²'}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” ${tx.id}
ğŸ“… ${formattedDate}
ğŸ‘¤ ${tx.customerName}

ğŸ’µ á€•á€±á€¸á€„á€½á€±: ${formatNum(tx.fromAmount)} ${tx.fromCurrency}
ğŸ’° á€›á€„á€½á€±: ${formatNumAuto(tx.toAmount)} ${tx.toCurrency}
ğŸ“Š Rate: 1 ${tx.fromCurrency} = ${tx.rate.toFixed(4)} ${tx.toCurrency}
ğŸ·ï¸ á€á€”á€ºá€†á€±á€¬á€„á€ºá€: ${formatNum(tx.serviceFee)} Ks
ğŸ’³ ${tx.payment.toUpperCase()}
${tx.recipient?.name ? `\nğŸ“ á€œá€€á€ºá€á€¶á€á€°: ${tx.recipient.name} (${tx.recipient.phone})` : ''}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á€€á€»á€±á€¸á€‡á€°á€¸á€á€„á€ºá€•á€«á€á€Šá€º ğŸ™
            `.trim();
        }

        function closeVoucherModal() {
            document.getElementById('voucherModal').classList.add('hidden');
        }

        function copyVoucherText() {
            navigator.clipboard.writeText(currentVoucherText).then(() => {
                showToast('á€€á€°á€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® ğŸ“‹');
            });
        }

        function shareVoucher() {
            if (navigator.share) {
                navigator.share({
                    title: 'Shwe Hundi Voucher',
                    text: currentVoucherText
                });
            } else {
                copyVoucherText();
            }
        }

        // ========== CUSTOMERS ==========
        function addCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            const phone = document.getElementById('newCustomerPhone').value.trim();
            const note = document.getElementById('newCustomerNote').value.trim();

            if (!name) {
                showToast('á€¡á€™á€Šá€º á€‘á€Šá€·á€ºá€•á€«!');
                return;
            }

            const customer = {
                id: 'CUS' + Date.now(),
                name: name,
                phone: phone,
                note: note,
                createdAt: new Date().toISOString()
            };

            appData.customers.push(customer);
            saveData();
            loadCustomerList();
            updateCustomerSelect();

            document.getElementById('newCustomerName').value = '';
            document.getElementById('newCustomerPhone').value = '';
            document.getElementById('newCustomerNote').value = '';

            showToast('á€‘á€Šá€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€® âœ“');
        }

        function loadCustomerList() {
            const container = document.getElementById('customerList');
            if (appData.customers.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-6 text-sm">á€–á€±á€¬á€€á€ºá€á€Šá€º á€™á€›á€¾á€­á€á€±á€¸á€•á€«</p>';
                return;
            }

            container.innerHTML = appData.customers.map(c => `
                <div class="list-item flex items-center justify-between">
                    <div>
                        <p class="font-bold text-white">${c.name}</p>
                        <p class="text-sm text-gray-400">${c.phone || 'á€–á€¯á€”á€ºá€¸ á€™á€›á€¾á€­'}</p>
                        ${c.note ? `<p class="text-xs text-gray-500">${c.note}</p>` : ''}
                    </div>
                    <button onclick="deleteCustomer('${c.id}')" class="p-2 text-red-400 hover:bg-red-500/20 rounded-full transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        function updateCustomerSelect() {
            const select = document.getElementById('customerSelect');
            select.innerHTML = '<option value="">-- á€–á€±á€¬á€€á€ºá€á€Šá€º á€›á€½á€±á€¸á€•á€« --</option>' +
                appData.customers.map(c => `<option value="${c.id}">${c.name} (${c.phone || '-'})</option>`).join('');
        }

        function deleteCustomer(id) {
            showConfirm('á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?', (confirmed) => {
                if (confirmed) {
                    appData.customers = appData.customers.filter(c => c.id !== id);
                    saveData();
                    loadCustomerList();
                    updateCustomerSelect();
                    showToast('á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®');
                }
            });
        }

        // ========== HISTORY ==========
        function loadHistory() {
            filterHistory();
        }

        function filterHistory() {
            const filterDate = document.getElementById('filterDate').value;
            const container = document.getElementById('historyList');
            
            let filtered = [...appData.transactions];
            if (filterDate) {
                filtered = appData.transactions.filter(tx => tx.timestamp.startsWith(filterDate));
            }

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-6 text-sm">á€™á€¾á€á€ºá€á€™á€ºá€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«</p>';
                return;
            }

            container.innerHTML = filtered.reverse().map(tx => {
                const date = new Date(tx.timestamp);
                const timeStr = `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                return `
                    <div class="list-item cursor-pointer" onclick='showVoucher(${JSON.stringify(tx)})'>
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="inline-block px-2 py-0.5 rounded-full text-xs font-medium ${tx.type === 'exchange' ? 'bg-teal-500/20 text-teal-300' : 'bg-blue-500/20 text-blue-300'}">
                                    ${tx.type === 'exchange' ? 'ğŸ’± á€„á€½á€±á€œá€²' : 'ğŸ“¤ á€„á€½á€±á€œá€½á€¾á€²'}
                                </span>
                                <p class="font-bold text-white mt-1">${tx.customerName}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-400">${timeStr}</p>
                                <p class="text-xs text-gray-500">${tx.id.slice(-8)}</p>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-300">${formatNum(tx.fromAmount)} ${tx.fromCurrency}</span>
                            <span class="text-gray-500">â†’</span>
                            <span class="font-bold text-amber-400">${formatNum(tx.toAmount, 0)} ${tx.toCurrency}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ========== DAILY CLOSING ==========
        function updateClosingSummary() {
            const today = new Date().toISOString().split('T')[0];
            const todayTx = appData.transactions.filter(tx => tx.timestamp.startsWith(today));

            document.getElementById('totalTransactions').textContent = todayTx.length;
            document.getElementById('totalServiceFee').textContent = formatNum(todayTx.reduce((sum, tx) => sum + tx.serviceFee, 0)) + ' Ks';

            let flow = { mmk: { in: 0, out: 0 }, thb: { in: 0, out: 0 }, usd: { in: 0, out: 0 } };

            todayTx.forEach(tx => {
                const fromKey = tx.fromCurrency.toLowerCase();
                const toKey = tx.toCurrency.toLowerCase();
                
                if (flow[fromKey]) flow[fromKey].in += tx.fromAmount;
                if (flow[toKey]) flow[toKey].out += tx.toAmount;
            });

            document.getElementById('mmkIn').textContent = formatNum(flow.mmk.in);
            document.getElementById('mmkOut').textContent = formatNum(flow.mmk.out);
            document.getElementById('thbIn').textContent = formatNum(flow.thb.in);
            document.getElementById('thbOut').textContent = formatNum(flow.thb.out);
            document.getElementById('usdIn').textContent = formatNum(flow.usd.in);
            document.getElementById('usdOut').textContent = formatNum(flow.usd.out);

            const serviceFeeTotal = todayTx.reduce((sum, tx) => sum + tx.serviceFee, 0);
            document.getElementById('estimatedProfit').textContent = formatNum(serviceFeeTotal) + ' Ks+';
        }

        function saveDailyClosing() {
            const closing = {
                date: new Date().toISOString().split('T')[0],
                stock: {
                    mmk: parseFloat(document.getElementById('stockMmk').value.replace(/,/g, '')) || 0,
                    thb: parseFloat(document.getElementById('stockThb').value.replace(/,/g, '')) || 0,
                    usd: parseFloat(document.getElementById('stockUsd').value.replace(/,/g, '')) || 0,
                    cny: parseFloat(document.getElementById('stockCny').value.replace(/,/g, '')) || 0
                },
                timestamp: new Date().toISOString()
            };

            appData.dailyClosing.push(closing);
            saveData();
            showToast('á€á€­á€™á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® âœ“');
        }

        // ========== SETTINGS ==========
        function showSettings() {
            showPrompt('á€†á€­á€¯á€„á€ºá€”á€¬á€™á€Šá€º', appData.settings.shopName, (newName) => {
                if (newName !== null && newName.trim()) {
                    appData.settings.shopName = newName.trim();
                    saveData();
                    showToast('á€á€­á€™á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® âœ“');
                }
            });
        }

        // ========== TOAST ==========
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2500);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>
